
<!-- saved from url=(0078)http://www.problems.ru/view_problem_details_new.php?id=98676&from_basket=98676 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=KOI8-R">
		<title>Информация о задаче</title>
		
		<link href="./Информация о задаче_files/viewer.css" rel="stylesheet" type="text/css">
		<script language="JavaScript" src="./Информация о задаче_files/all.js"></script>
	</head>
	<body>
		<div class="componentbox">
			<table class="componentboxheader">
				<tbody><tr>
					<td align="center">
						<font size="+2">
							<b>ЗАДАЧИ</b>
						</font>
						<br>
						<a class="componentboxheaderlink" href="http://www.problems.ru/">
							problems.ru						</a>
					</td>
					<td width="100%" align="center">
						<a class="componentboxheaderlink" href="http://www.problems.ru/about_system.php">О проекте</a>
						|
						<a class="componentboxheaderlink" href="http://www.problems.ru/authors.php">Об авторах</a>
						|
						<a class="componentboxheaderlink" href="http://www.problems.ru/thes.php">Справочник</a>
						<br>
						Каталог
						<a class="componentboxheaderlink" href="http://www.problems.ru/view_by_subject_new.php?parent=">по темам</a>
						| 
						<a class="componentboxheaderlink" href="http://www.problems.ru/view_by_source_new.php?parent=">по источникам</a>
						|
						<a class="componentboxheaderlink" href="http://www.problems.ru/search_new.php">Поиск</a>
						| 
						<form class="headerproblembynumberform" method="get" action="http://www.problems.ru/view_problem_details_new.php">
							<nobr>К задаче N <input type="text" size="5" name="id">
								<input type="image" src="./Информация о задаче_files/go.gif" width="18" height="18" border="0" alt="Go!" onclick="javascript:location = &#39;/view_problem_details_new.php?id=&#39; + forms[0].id.value;">
								<input type="submit" style="display:none;"></nobr>
						</form>
						<br>
					</td>
					<td align="center">
						<nobr>Проект <a class="componentboxheaderlink" href="http://www.mccme.ru/">МЦНМО</a></nobr>
						<br>
						<nobr><small>при участии</small></nobr>
						<br>
						<nobr><a class="componentboxheaderlink" href="http://www.sch57.msk.ru/">школы 57</a></nobr>
					</td>
				</tr>
			</tbody></table>
		</div>
		<table class="viewingtable">
			<tbody><tr class="viewingtablecell">
				<td class="viewingtablecell">
					<div class="componentboxsecond">
						<div class="componentboxheader">
 Задача 98676<br>
						</div>
						<div class="componentboxcontents">
							<table class="problemdetailscaptiontable">
								<tbody><tr>
									<td class="problemdetailssubject">
										<table class="problemdetailssubjecttable">
											<tbody><tr class="problemdetailssubjecttablecell">
												<td class="problemdetailssubjecttablecell" rowspan="1">
													Тема:&nbsp;&nbsp;&nbsp;
												</td>
												<td class="problemdetailssubjecttablecell">[</td>
												<td class="problemdetailssubjecttablecell">
													<nobr>
														<a class="componentboxlink" href="http://www.problems.ru/view_by_subject_new.php?parent=1172">
															Куча														</a>
													</nobr>
												</td>
												<td class="problemdetailssubjecttablecell">]</td>
											</tr>
										</tbody></table>
									</td>
									<td class="problemdetailsdifficulty">
<nobr>Сложность: 5</nobr><br><nobr>Классы: 8,9,10,11</nobr><br>
Название задачи: Менеджер памяти.<br>
									</td>
									<td class="problemdetailsbasket">
										<a class="componentboxlink" href="http://www.problems.ru/view_problem_details_new.php?id=98676&into_basket=98676">
											<img src="./Информация о задаче_files/into_basket.gif" width="90" height="24" border="0" alt="В корзину"></a><br>
										<nobr>
											<a class="componentboxlink" href="http://www.problems.ru/feedback.php?comment_problem=98676&comment_problem_url=%2Fview_problem_details_new.php%3Fid%3D98676%26from_basket%3D98676">
												Прислать комментарий
											</a>
										</nobr>
									</td>
								</tr>
							</tbody></table>
<br><h3>Условие</h3><p><table cellspacing="0" border="0" cellpadding="7" width="595">
<tbody><tr><td width="72%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">Имя входного файла:</font></p></td>
<td width="28%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">memory.in</font></p></td>
</tr>
<tr><td width="72%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">Имя выходного файла:</font></p></td>
<td width="28%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">memory.out</font></p></td>
</tr>
<tr><td width="72%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">Максимальное время работы на одном тесте:</font></p></td>
<td width="28%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">2 секунды</font></p></td>
</tr>
<tr><td width="72%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">Максимальный объем используемой памяти:</font></p></td>
<td width="28%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">64 мегабайта</font></p></td>
</tr>
<tr><td width="72%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">Максимальная оценка за задачу:</font></p></td>
<td width="28%" valign="TOP">
<font face="Courier New" size="3"></font><p align="JUSTIFY"><font face="Courier New" size="3">100 баллов</font></p></td>
</tr>
<tr><td width="72%" valign="TOP">&nbsp;</td>
<td width="28%" valign="TOP">&nbsp;</td>
</tr>
</tbody></table>

<font size="3"></font></p><p align="JUSTIFY"><font size="3">Пете поручили написать менеджер памяти для новой стандартной библиотеки языка H++. В распоряжении у менеджера находится массив из <i>N</i> последовательных ячеек памяти, пронумерованных от 1 до <i>N</i>. Задача менеджера - обрабатывать запросы приложений на выделение и освобождение памяти.</font></p><font size="3">
<p align="JUSTIFY">Запрос на выделение памяти имеет один параметр <i>K</i>. Такой запрос означает, что приложение просит выделить ему <i>K</i> последовательных ячеек памяти. Если в распоряжении менеджера есть хотя бы один свободный блок из <i>K</i> последовательных ячеек, то он обязан в ответ на запрос выделить такой блок. При этом непосредственно перед самой первой ячейкой памяти выделяемого блока не должно располагаться свободной ячейки памяти. После этого выделенные ячейки становятся занятыми и не могут быть использованы для выделения памяти, пока не будут освобождены. Если блока из <i>K</i> последовательных свободных ячеек нет, то запрос отклоняется.</p>
<p align="JUSTIFY">Запрос на освобождение памяти имеет один параметр <i>T</i>. Такой запрос означает, что менеджер должен освободить память, выделенную ранее при обработке запроса с порядковым номером <i>T.</i> Запросы нумеруются, начиная с единицы. Гарантируется, что запрос с номером <i>T</i> - запрос на выделение, причем к нему еще не применялось освобождение памяти. Освобожденные ячейки могут снова быть использованы для выделения памяти. Если запрос с номером <i>T</i> был отклонен, то текущий запрос на освобождение памяти игнорируется.</p>
<p align="JUSTIFY">Требуется написать менеджер памяти, удовлетворяющий приведенным критериям.</p>
</font><b><i><font face="Arial"><p align="JUSTIFY">Формат входных данных</p>
</font></i></b><font size="3"><p align="JUSTIFY">Первая строка входного файла содержит числа <i>N</i> и <i>M</i> - количество ячеек памяти и количество запросов соответственно (1 ≤ <i>N</i> ≤ 2<sup>31</sup> - 1; 1 ≤ <i>M</i> ≤ 10<sup>5</sup>). Каждая из следующих <i>M</i> строк содержит по одному числу: (<i>i</i>+1)-я строка входного файла (1 ≤ <i>i</i> ≤ <i>M</i>) содержит либо положительное число <i>K</i>, если <i>i</i>-й запрос - запрос на выделение с параметром <i>K </i>(1 ≤ <i>K</i> ≤ <i>N</i>), либо отрицательное число -<i>T</i>, если <i>i</i>-й запрос - запрос на освобождение с параметром <i>T</i> (1 ≤ <i>T</i> &lt; <i>i</i>). </p>
</font><b><i><font face="Arial"><p align="JUSTIFY">Формат выходных данных</p>
</font></i></b><font size="3"><p align="JUSTIFY">Для каждого запроса на выделение памяти выведите в выходной файл результат обработки этого запроса: для успешных запросов выведите номер первой ячейки памяти в выделенном блоке, для отклоненных запросов выведите число -1. Результаты нужно выводить в порядке следования запросов во входном файле.</p>
</font><b><i><font face="Arial"><p align="JUSTIFY">Пример</p></font></i></b>
<table border="" cellspacing="1" cellpadding="7" width="667">
<tbody><tr><td width="50%" valign="TOP">
<b><font face="Courier New" size="3"></font></b><font face="Courier New" size="3"></font><p align="CENTER"><font face="Courier New" size="3"><b>memory.in</b></font></p></td>
<td width="50%" valign="TOP">
<b><font face="Courier New" size="3"></font></b><font face="Courier New" size="3"></font><p align="CENTER"><font face="Courier New" size="3"><b>memory.out</b></font></p></td>
</tr>
<tr><td width="50%" valign="TOP">
<font face="Courier New" size="3"><p>6 8</p>
<p>2</p>
<p>3</p>
<p>-1</p>
<p>3</p>
<p>3</p>
<p>-5</p>
<p>2</p>
</font><p><font face="Courier New" size="3">2</font></p></td>
<td width="50%" valign="TOP">
<font face="Courier New" size="3"><p>1</p>
<p>3</p>
<p>-1</p>
<p>-1</p>
<p>1</p>
</font><p><font face="Courier New" size="3">-1</font></p></td>
</tr>
</tbody></table><br><small>Также доступны документы в формате <a href="http://www.problems.ru/show_document.php?id=1404487">DOC</a></small>
<br>
<br><h3>Решение</h3><p><br><a href="http://www.problems.ru/show_document.php?id=1404490">Генератор тестов и проверяющая программа</a>

<br><a href="http://www.problems.ru/show_document.php?id=1404491">Решения, написанные членами научного комитета и жюри Всероссийской олимпиады</a>

<b><font face="Arial" size="5"></font></b></p><p align="JUSTIFY"><b><font face="Arial" size="5">Разбор задачи "Менеджер памяти"</font></b></p><b><font face="Arial" size="5">
</font></b><p align="JUSTIFY">Разобьем всю память на отрезки, каждый из которых состоит либо из свободных, либо из занятых (выделенных в ответ на запросы) ячеек.</p>
<p align="JUSTIFY">Будем некоторым образом хранить свободные и занятые отрезки. Важное ограничение, упомянутое в условии, состоит в том, что выделенный кусок памяти может находиться либо в начале памяти, либо непосредственно после занятого фрагмента памяти. В связи с этим потребуем, чтобы свободные отрезки не могли следовать друг за другом.</p>
<p align="JUSTIFY">Нам необходимо уметь:</p>
<ol>

<p align="JUSTIFY"></p><li>по заданному объёму памяти находить свободный отрезок, из которого данный объём можно выделить;</li><p></p>
<p align="JUSTIFY"></p><li>по номеру запроса находить занятый отрезок, выделенный этим отрезком;</li><p></p>
<p align="JUSTIFY"></p><li>по занятому отрезку находить свободные отрезки, находящиеся непосредственно перед и после него.</li><p></p></ol>

<p align="JUSTIFY">Поскольку по условию оптимальность не требуется, мы можем всегда выделять память из самого длинного имеющегося свободного отрезка.</p>
<p align="JUSTIFY">Будем использовать следующие структуры данных:</p>
<ol>

<p align="JUSTIFY"></p><li>двусвязный список свободных отрезков;</li><p></p>
<p align="JUSTIFY"></p><li>массив запросов, где индексом является номер запроса, а значением - выделенный при выполнении этого запроса отрезок (или некоторое специальное значение вроде "nil" или "NULL", если память выделена не была или запрос не был запросом на выделение);</li><p></p>
<p align="JUSTIFY"></p><li>кучу (heap) из указателей на свободные отрезки; куча строится по их длинам. </li><p></p></ol>

<p align="JUSTIFY">(Куча и двусвязный список должны содержать одни и те же свободные отрезки; этого можно добиться, используя указатели или классы Delphi и Visual Basic.)</p>
<p align="JUSTIFY">Куча - это массив из <i>N</i> чисел <i>H</i><sub>1</sub>,&nbsp;...,&nbsp;<i>H<sub>N</sub></i>, таких, что для любого <i>i</i>, 1&nbsp;&lt;&nbsp;<i>i</i>&nbsp;≤&nbsp;<i>N</i>, выполняется условие <i>H</i><sub>[<i>i</i>/2]</sub>&nbsp;≥<i>H<sub>i</sub></i>. Первый элемент в куче всегда не меньше остальных ее элементов, поэтому операция нахождения максимума в куче выполняется за время <i>O</i>(1). Можно реализовать операции добавления элементов в кучу, удаления из нее и изменения элемента за время <i>O</i>(log <i>N</i>); как это сделать, описано, например, в книге Т. Кормена, Ч. Лейзерсона, Р. Ривеста "Алгоритмы: построение и анализ", М.. МЦНМО, 2000.</p>
<p align="JUSTIFY">Обработка запроса на выделение памяти производится следующим образом. Рассмотрим самый длинный свободный отрезок <i>A</i>: с помощью кучи мы можем найти его в списке за <i>O</i>(1). Если длины отрезка <i>A</i> недостаточно, чтобы вместить требуемый блок памяти, то такой блок невозможно разместить. Иначе мы размещаем данный блок, вставляя соответствующий занятый отрезок в список и укорачивая отрезок <i>A</i>.</p>
<p align="JUSTIFY">Обработка запроса на освобождение памяти производится следующим образом. Мы удаляем соответствующий занятый отрезок <i>A</i> из списка, после чего разбираем 4 случая:</p>
<ol>

<p align="JUSTIFY"></p><li>Непосредственно слева и справа от <i>A</i> не располагается свободного отрезка. В этом случае мы делаем <i>A</i> свободным отрезком и добавляем его в кучу.</li><p></p>
<p align="JUSTIFY"></p><li>Непосредственно слева от <i>A</i> не располагается свободного отрезка, непосредственно справа от <i>A</i> располагается свободный отрезок <i>B</i>. В этом случае мы удаляем отрезок <i>A</i> из списка и удлиняем отрезок <i>B</i>.</li><p></p>
<p align="JUSTIFY"></p><li>Непосредственно справа от <i>A</i> не располагается свободного отрезка, непосредственно слева от <i>A</i> располагается свободный отрезок. Действуем аналогично случаю 2.</li><p></p>
<p align="JUSTIFY"></p><li>Непосредственно слева от <i>A</i> располагается свободный отрезок <i>B</i>, непосредственно справа от <i>A</i> располагается свободный отрезок <i>C</i>. В этом случае мы удаляем отрезки <i>A</i> и <i>C</i> из списка и удлиняем отрезок <i>B</i>.</li><p></p></ol><br><small>Также доступны документы в формате <a href="http://www.problems.ru/show_document.php?id=1404489">DOC</a></small>
<br>
<h3>Источники и прецеденты использования</h3>
<div class="problemdetailssourcetablecontainer">
	<table class="problemdetailssourcetable">
<tbody><tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecellhead" colspan="2">
<a class="componentboxlink" href="http://www.problems.ru/view_by_source_new.php?parent=204568"></a>	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecellhead" colspan="2">
<a class="componentboxlink" href="http://www.problems.ru/view_by_source_new.php?parent=194467">олимпиада</a>	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
Название	</td>
	<td class="problemdetailssourcetablecell">
Всероссийская олимпиада по информатике	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
предмет	</td>
	<td class="problemdetailssourcetablecell">
информатика	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecellhead" colspan="2">
<a class="componentboxlink" href="http://www.problems.ru/view_by_source_new.php?parent=194468">год</a>	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
Дата	</td>
	<td class="problemdetailssourcetablecell">
2005 год	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
Номер	</td>
	<td class="problemdetailssourcetablecell">
17	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
Место проведения	</td>
	<td class="problemdetailssourcetablecell">
Новосибирск	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecellhead" colspan="2">
<a class="componentboxlink" href="http://www.problems.ru/view_by_source_new.php?parent=194470">задача</a>	</td>
</tr>
<tr class="problemdetailssourcetablecell">
	<td class="problemdetailssourcetablecell">
Номер	</td>
	<td class="problemdetailssourcetablecell">
2	</td>
</tr>
	</tbody></table>
</div>
						</div>
					</div>
				</td>
			</tr>
		</tbody></table>
		<hr>
		<table class="footertable">
			<tbody><tr class="footercell">
				<td class="footercell">
					© 2004-2008
					<a class="componentboxlink" href="http://www.mccme.ru/">МЦНМО</a>
					(<a class="componentboxlink" href="http://www.problems.ru/about_system.php#copyright">о копирайте</a>)
					<br>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="componentboxlink" href="http://www.problems.ru/editor/login.php">
						<img border="0" src="./Информация о задаче_files/ed.png">
					</a>
				</td>
				<td align="center">
					<a class="componentboxlink" href="http://www.problems.ru/feedback.php">Пишите нам</a>
					<br>
				</td>
				<td class="footercell" align="right">
					<!--LiveInternet counter-->
						<script language="JavaScript"><!--
document.write('<a href="http://www.liveinternet.ru/click" '+
'target=_blank><img src="http://counter.yadro.ru/hit?t23.11;r'+
escape(document.referrer)+((typeof(screen)=='undefined')?'':
';s'+screen.width+'*'+screen.height+'*'+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+';u'+escape(document.URL)+
';'+Math.random()+
'" alt="liveinternet.ru" '+
'border=0 width=88 height=15></a>')//-->
						</script><a href="http://www.liveinternet.ru/click" target="_blank"><img src="./Информация о задаче_files/hit" alt="liveinternet.ru" border="0" width="88" height="15"></a>
					<!--/LiveInternet-->
					<!--begin of Top100 logo-->
						<a href="http://top100.rambler.ru/top100/">
							<img src="./Информация о задаче_files/banner-88x31-rambler-blue.gif" alt="" width="88" height="31" border="0">
						</a>
					<!--end of Top100 logo -->
					<!--begin of Top100 code-->
						<a href="http://top100.rambler.ru/top100/">
							<img src="./Информация о задаче_files/top100.cnt" alt="Rambler&#39;s Top100" width="1" height="1" border="0">
						</a>
					<!--end of Top100 code-->
				</td>
			</tr>
		</tbody></table>
		<p>
		<small>
			Проект осуществляется при поддержке
			<nobr>
				<a class="componentboxlink" href="http://www.educom.ru/">Департамента образования г.Москвы</a>
			</nobr>
			и
			<nobr>
				<a class="componentboxlink" href="http://www.mioo.ru/">Московского института открытого образования</a>.
			</nobr>
		</small>
	

</p></body></html>